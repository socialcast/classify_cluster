#!/usr/bin/env ruby

require "classify_cluster"
require "classify_cluster/version"
require "commander/import"
require 'yaml'

program :name, "Classify Cluster"
program :version, ClassifyCluster::VERSION
program :description, 'Generates configurations for different aspects of the cluster based off of one configuration.'
default_command :puppet

command :puppet do |c|
  c.syntax = 'classify puppet <clustername> [options]'
  c.description = 'Returns on STDOUT YAML dump of the clusters puppet config'
  c.option '--config STRING', String, 'Location to config file.'
  c.option '--export STRING', String, 'Location to output puppet cluster config'
  c.action do |args, options|
    options.default :config => ClassifyCluster::Base.default_config_file, :export => ENV['HOME']
    ClassifyCluster::Writers::Puppet.export!(options.export, :cluster => args[0], :config_file => options.config)
    say("Success!")
  end
end

command :config do |c|
  c.syntax = 'classify config <clustername> [options]'
  c.description = 'Runs an interactive script to generate a cluster configuration'
  c.option '--export STRING', String, 'Location to output cluster configuration'
  c.option '--cluster STRING', String, 'Cluster being created'
  c.option '--defaults STRING', String, 'Location to load cluster defaults'
  c.option '--variables STRING', String, 'Location to load cluster variables'
  c.action do |args, options|
    options.default :export => ClassifyCluster::Base.default_config_file, :defaults => '', :variables => ''
    ClassifyCluster::Writers::Classify.export!(ClassifyCluster::Readers::Cli.start!(options.cluster, options.defaults, options.variables))
  end
end