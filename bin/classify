#!/usr/bin/env ruby

require "classify_cluster"
require "classify_cluster/version"
require "commander/import"
require 'yaml'

program :name, "Classify Cluster"
program :version, ClassifyCluster::VERSION
program :description, 'Generates configurations for different aspects of the cluster based off of one configuration.'
default_command :puppet

command :puppet do |c|
  c.syntax = 'classify puppet <clustername> <hostname> [options]'
  c.description = 'Returns on STDOUT YAML dump of this nodes puppet config'
  c.option '--config STRING', String, 'Location to config file.'
  c.action do |args, options|
    options.default :config => File.join('/etc', 'cluster.yml')
    cluster = args[0]
    hostname = args[1]
    
    say "#{YAML.dump(ClassifyCluster.cluster_config(:cluster => cluster, :config_file => options.config)[hostname])}"
  end
end